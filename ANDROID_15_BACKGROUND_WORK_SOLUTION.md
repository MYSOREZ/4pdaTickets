# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã 6-—á–∞—Å–æ–≤–æ–≥–æ –ª–∏–º–∏—Ç–∞ Android 15 –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## –ü—Ä–æ–±–ª–µ–º–∞

–ù–∞ Android 15 –∏ HyperOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º–∏ foreground-—Å–µ—Ä–≤–∏—Å–∞–º–∏ —Ç–∏–ø–∞ `dataSync` –∏ `mediaProcessing` –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã **6 —á–∞—Å–∞–º–∏ —Å—É–º–º–∞—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∑–∞ 24 —á–∞—Å–∞**. –ü–æ—Å–ª–µ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –ª–∏–º–∏—Ç–∞:

- –°–∏—Å—Ç–µ–º–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `Service.onTimeout()`
- –ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ ‚Üí `RemoteServiceException` –∏ –∫—Ä—ç—à
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ FGS –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω –±–µ–∑ –≤—ã–≤–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –ø–µ—Ä–µ–¥–Ω–∏–π –ø–ª–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- –í –ª–æ–≥–∞—Ö: `ForegroundServiceStartNotAllowedException: Time limit already exhausted for foreground service type dataSync`

## –ù–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ

–ú—ã **–ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–∞–∑–∞–ª–∏—Å—å –æ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ foreground-—Å–µ—Ä–≤–∏—Å–∞** –∏ –ø–µ—Ä–µ—à–ª–∏ –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å —Ç–æ—á–Ω—ã–º–∏ –±—É–¥–∏–ª—å–Ω–∏–∫–∞–º–∏.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ "–¥–æ" (–ø—Ä–æ–±–ª–µ–º–Ω–∞—è)
```
MainActivity ‚Üí startForegroundService() ‚Üí ForegroundMonitorService (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∞–∫—Ç–∏–≤–µ–Ω) ‚Üí –ª–∏–º–∏—Ç 6—á ‚Üí –∫—Ä—ç—à
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ "–ø–æ—Å–ª–µ" (–±–µ–∑–æ–ø–∞—Å–Ω–∞—è)
```
MainActivity ‚Üí ExactAlarmScheduler ‚Üí ExactAlarmReceiver ‚Üí QuickCheckWorker (–∫–æ—Ä–æ—Ç–∫–∞—è –∑–∞–¥–∞—á–∞) ‚Üí NotificationUpdater ‚Üí –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–ª–ª–∞—Ä–º–∞
```

## –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è

### 1. ExactAlarmScheduler.kt
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—á–Ω—ã—Ö –±—É–¥–∏–ª—å–Ω–∏–∫–æ–≤ –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `AlarmManager.setExactAndAllowWhileIdle()` –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª: 60 —Å–µ–∫—É–Ω–¥** (–¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø–æ–ª–∏—Ç–∏–∫–∞–º)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ELAPSED_REALTIME_WAKEUP` (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å–º–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–∏)
- **–Ø–∫–æ—Ä–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∏–∑–±–µ–≥–∞–µ—Ç –¥—Ä–µ–π—Ñ –≤—Ä–µ–º–µ–Ω–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ WorkManager –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- –¢—Ä–µ–±—É–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ `SCHEDULE_EXACT_ALARM` –Ω–∞ Android 14+

```kotlin
fun scheduleNextAlarmSeconds(context: Context, intervalSeconds: Int) {
    val safeInterval = maxOf(intervalSeconds, 60) // –ú–∏–Ω–∏–º—É–º 1 –º–∏–Ω—É—Ç–∞
    
    // –Ø–∫–æ—Ä–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—Ä–µ–π—Ñ–∞
    val lastScheduled = prefs.getLong("last_scheduled", 0L)
    val now = SystemClock.elapsedRealtime()
    val triggerTime = if (lastScheduled == 0L) {
        now + (safeInterval * 1000L)
    } else {
        val intervalMs = safeInterval * 1000L
        val n = ((now - lastScheduled) / intervalMs) + 1
        lastScheduled + (n * intervalMs)
    }
    
    alarmManager.setExactAndAllowWhileIdle(
        AlarmManager.ELAPSED_REALTIME_WAKEUP,
        triggerTime,
        pendingIntent
    )
}
```

### 2. ExactAlarmReceiver.kt
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –±—É–¥–∏–ª—å–Ω–∏–∫–æ–≤

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫—É—é –∑–∞–¥–∞—á—É `QuickCheckWorker` —á–µ—Ä–µ–∑ WorkManager
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç `enqueueUniqueWork`** –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –Ω–∞–ª–æ–∂–µ–Ω–∏–π
- **Constraints:** —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ (`CONNECTED`)
- –°—Ä–∞–∑—É –ø–ª–∞–Ω–∏—Ä—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π –±—É–¥–∏–ª—å–Ω–∏–∫
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–ª—É–∂–µ–±–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ù–µ –¥–µ—Ä–∂–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å –∞–∫—Ç–∏–≤–Ω—ã–º

```kotlin
WorkManager.getInstance(context).enqueueUniqueWork(
    "ticket_check_work",
    ExistingWorkPolicy.REPLACE,
    workRequest
)
```

### 3. QuickCheckWorker.kt
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –†–∞–±–æ—Ç–∞–µ—Ç 5-15 —Å–µ–∫—É–Ω–¥ –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–∞–ª–æ–∂–µ–Ω–∏–π** —á–µ—Ä–µ–∑ `@Volatile isRunning` —Ñ–ª–∞–≥
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç WebView –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–∏–∫–µ—Ç–æ–≤ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ)
- JavaScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ DOM
- **Timeout 15 —Å–µ–∫—É–Ω–¥** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º retry –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤
- **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç foreground-—Å–µ—Ä–≤–∏—Å**

```kotlin
companion object {
    @Volatile
    private var isRunning = false
}

override fun doWork(): Result {
    if (isRunning) {
        Log.w(TAG, "‚ö†Ô∏è –ü—Ä–µ–¥—ã–¥—É—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –µ—â–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
        return Result.success()
    }
    isRunning = true
    try {
        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
    } finally {
        isRunning = false
    }
}
```

### 4. NotificationUpdater.kt
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –±–µ–∑ FGS

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç ongoing-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ë–ï–ó foreground-—Å–µ—Ä–≤–∏—Å–∞
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–∏–∫–µ—Ç–æ–≤
- –î–≤–∞ —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
  - –°–ª—É–∂–µ–±–Ω–æ–µ (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ, —Å ongoing=true)
  - Push –æ –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–∞—Ö (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ)

### 5. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ MainActivity.startMonitoringService():**
```kotlin
// –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å–∫–∞–µ–º –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
val immediateWorkRequest = OneTimeWorkRequestBuilder<QuickCheckWorker>()
    .setConstraints(constraints)
    .addTag("immediate_start_check")
    .build()

WorkManager.getInstance(this).enqueueUniqueWork(
    "immediate_ticket_check",
    ExistingWorkPolicy.REPLACE,
    immediateWorkRequest
)

// –ó–∞—Ç–µ–º –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
ExactAlarmScheduler.scheduleNextAlarmSeconds(this, intervalSeconds)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è **—Å—Ä–∞–∑—É** –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥" (3-4 —Å–µ–∫—É–Ω–¥—ã)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∂–¥–µ—Ç –ø–µ—Ä–≤—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (60+ —Å–µ–∫—É–Ω–¥)
- –î–∞–ª—å–Ω–µ–π—à–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

### 6. TicketMonitor.kt
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** JavaScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è WebView

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–∞—Ä—Å–∏—Ç DOM —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–∏–∫–µ—Ç–æ–≤
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å—ã —Ç–∏–∫–µ—Ç–æ–≤ (0=–Ω–æ–≤—ã–π, 2=–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π)
- –ü–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Android —á–µ—Ä–µ–∑ `@JavascriptInterface`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–∞—à–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è

### ‚úÖ –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è 6 —á–∞—Å–æ–≤
- –¢–æ—á–Ω—ã–µ –±—É–¥–∏–ª—å–Ω–∏–∫–∏ –Ω–µ –ø–æ–¥–ø–∞–¥–∞—é—Ç –ø–æ–¥ –ª–∏–º–∏—Ç FGS
- –ú–æ–∂–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å—É—Ç–∫–∞–º–∏ –±–µ–∑ –ø–µ—Ä–µ—Ä—ã–≤–∞
- –ù–µ—Ç —Ä–∏—Å–∫–∞ `RemoteServiceException`

### ‚úÖ –≠–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "—Å–ø–∏—Ç" –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ 5-10 —Å–µ–∫—É–Ω–¥ –∫–∞–∂–¥—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
- –°–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ

### ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- –ë—É–¥–∏–ª—å–Ω–∏–∫–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –¥–∞–∂–µ –≤ Doze Mode
- –ù–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —É–±–∏–π—Ü —Ñ–æ–Ω–∞ MIUI/HyperOS
- –†–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –≤—Å–µ—Ö –≤–µ—Ä—Å–∏—è—Ö Android

### ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
- **–ú–∏–Ω–∏–º—É–º 1 –º–∏–Ω—É—Ç–∞** (–¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø–æ–ª–∏—Ç–∏–∫–∞–º)
- –î–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —á–∞—Å–æ–≤
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —á–µ—Ä–µ–∑ SettingsActivity
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ WorkManager (15+ –º–∏–Ω—É—Ç) –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

### ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫
- **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (3-4 —Å–µ–∫—É–Ω–¥—ã)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- –ù–µ—Ç –¥–æ–ª–≥–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:

### HyperOS/MIUI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
1. **–ë–∞—Ç–∞—Ä–µ—è:** "–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π" –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫:** –í–∫–ª—é—á–∏—Ç—å
3. **–û—Ç–∑—ã–≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π:** –û—Ç–∫–ª—é—á–∏—Ç—å "–ü—Ä–∏ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏ –æ—Ç–∑—ã–≤–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è"
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** Lock Apps - –∑–∞–∫—Ä–µ–ø–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### Android –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
1. **–¢–æ—á–Ω—ã–µ –±—É–¥–∏–ª—å–Ω–∏–∫–∏:** –†–∞–∑—Ä–µ—à–∏—Ç—å —á–µ—Ä–µ–∑ "–ë—É–¥–∏–ª—å–Ω–∏–∫–∏ –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è" (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞—Ç–∞—Ä–µ–∏:** –ò—Å–∫–ª—é—á–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:** –†–∞–∑—Ä–µ—à–∏—Ç—å –¥–ª—è –≤—Å–µ—Ö –∫–∞–Ω–∞–ª–æ–≤
4. **Doze Mode:** –ü—Ä–∏ —á–∞—Å—Ç—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞—Ö —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç "—Å–∫–ª–µ–∏–≤–∞—Ç—å" –±—É–¥–∏–ª—å–Ω–∏–∫–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ AndroidManifest.xml:
```xml
<uses-permission android:name="android.permission.SCHEDULE_EXACT_ALARM" />
<uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
```

**–í–∞–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ `SCHEDULE_EXACT_ALARM` (–Ω–µ `USE_EXACT_ALARM`), —Ç–∞–∫ –∫–∞–∫:
- `USE_EXACT_ALARM` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –±—É–¥–∏–ª—å–Ω–∏–∫–æ–≤/–∫–∞–ª–µ–Ω–¥–∞—Ä–µ–π
- Google Play —á–∞—Å—Ç–æ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å `USE_EXACT_ALARM`
- `WAKE_LOCK` –Ω–µ –Ω—É–∂–µ–Ω - WorkManager —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç wake locks

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ AndroidManifest.xml:
```xml
<receiver android:name=".ExactAlarmReceiver" 
    android:enabled="true" 
    android:exported="false" />

<receiver android:name=".BootReceiver"
    android:enabled="true"
    android:exported="true">
    <intent-filter android:priority="1000">
        <action android:name="android.intent.action.BOOT_COMPLETED" />
    </intent-filter>
</receiver>
```

### –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏:
- `BootReceiver` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –±—ã–ª –ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω –¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- –ü–ª–∞–Ω–∏—Ä—É–µ—Ç –ø–µ—Ä–≤—ã–π –±—É–¥–∏–ª—å–Ω–∏–∫

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ö–ª—é—á–µ–≤—ã–µ –ª–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
```
MainActivity: üöÄ –ó–∞–ø—É—â–µ–Ω–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
ExactAlarmScheduler: ‚úÖ –¢–æ—á–Ω—ã–π –±—É–¥–∏–ª—å–Ω–∏–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ X —Å–µ–∫—É–Ω–¥
ExactAlarmReceiver: ‚è∞ –¢–æ—á–Ω—ã–π –±—É–¥–∏–ª—å–Ω–∏–∫ —Å—Ä–∞–±–æ—Ç–∞–ª
QuickCheckWorker: üîç –ù–∞—á–∏–Ω–∞–µ–º –±—ã—Å—Ç—Ä—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–∫–µ—Ç–æ–≤
QuickCheckWorker: üìä –ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑ console: DEBUG
QuickCheckWorker: ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
NotificationUpdater: ‚úÖ –°–ª—É–∂–µ–±–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ
```

### –ü—Ä–∏–∑–Ω–∞–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã:
- **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (3-4 —Å–µ–∫—É–Ω–¥—ã)
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –±—É–¥–∏–ª—å–Ω–∏–∫–æ–≤ –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª—É
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö
- Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–∞—Ö
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ `ForegroundServiceDidNotStartInTimeException` –≤ –ª–æ–≥–∞—Ö

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤–µ—Ä—Å–∏–∏ Android:
- Android 12+ (API 31+) - –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- Android 14+ - —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —Ç–æ—á–Ω—ã–µ –±—É–¥–∏–ª—å–Ω–∏–∫–∏
- Android 15 - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ, –æ–±—Ö–æ–¥–∏—Ç –ª–∏–º–∏—Ç 6—á

### ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞:
- HyperOS (Xiaomi)
- MIUI 14/15
- Stock Android
- Custom ROM (crDroid)

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (Must-fix)

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ:
1. **–†–∞–∑—Ä–µ—à–µ–Ω–∏—è:** –£–±—Ä–∞–Ω `USE_EXACT_ALARM` –∏ `WAKE_LOCK` - –æ—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ `SCHEDULE_EXACT_ALARM`
2. **–°—Ç–∞–±–∏–ª—å–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `ELAPSED_REALTIME_WAKEUP` + —è–∫–æ—Ä–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª:** 60 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø–æ–ª–∏—Ç–∏–∫–∞–º –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
4. **–ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–∞–ª–æ–∂–µ–Ω–∏–π:** `enqueueUniqueWork` + `@Volatile isRunning` —Ñ–ª–∞–≥
5. **Fallback –º–µ—Ö–∞–Ω–∏–∑–º:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ WorkManager –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
6. **Network constraints:** –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ç–∏ –¥–ª—è WorkManager –∑–∞–¥–∞—á
7. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
8. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä—ç—à–∏:** –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –≤—ã–∑–æ–≤—ã `startForegroundService()` –±–µ–∑ `startForeground()`
9. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫ (60-600 —Å–µ–∫)

### ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- **Doze Mode:** –°–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç "—Å–∫–ª–µ–∏–≤–∞—Ç—å" —á–∞—Å—Ç—ã–µ –±—É–¥–∏–ª—å–Ω–∏–∫–∏ (< 5 –º–∏–Ω—É—Ç)
- **Battery Saver:** –ú–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–Ω—ã–µ –±—É–¥–∏–ª—å–Ω–∏–∫–∏
- **Google Play:** –¢—Ä–µ–±—É–µ—Ç –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ—á–Ω—ã—Ö –±—É–¥–∏–ª—å–Ω–∏–∫–æ–≤
- **–≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ:** –ß–∞—Å—Ç—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã (< 1 –º–∏–Ω—É—Ç—ã) –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç—Å—è

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ù–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—É 6-—á–∞—Å–æ–≤–æ–≥–æ –ª–∏–º–∏—Ç–∞ Android 15, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è:

1. **–°—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É** –±–µ–∑ –∫—Ä—ç—à–µ–π –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
2. **–≠–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** –∑–∞ —Å—á–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏—Ö –∑–∞–¥–∞—á –∏ —Ä–∞–∑—É–º–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** –Ω–∞ –≤—Å–µ—Ö –≤–µ—Ä—Å–∏—è—Ö Android –∏ –ø—Ä–æ—à–∏–≤–∫–∞—Ö
4. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∞–º** Google Play –∏ Android
5. **–ó–∞—â–∏—Ç—É –æ—Ç –Ω–∞–ª–æ–∂–µ–Ω–∏–π** –∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
6. **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
7. **–ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–æ–∫

### –ò—Ç–æ–≥–æ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –∫—Ä—ç—à–∏** `ForegroundServiceDidNotStartInTimeException`
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª** –æ—Ç 60 —Å–µ–∫—É–Ω–¥ –¥–æ 10 –º–∏–Ω—É—Ç
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞** –±–µ–∑ 6-—á–∞—Å–æ–≤–æ–≥–æ –ª–∏–º–∏—Ç–∞ Android 15

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ç–æ—á–Ω—ã–º–∏ –±—É–¥–∏–ª—å–Ω–∏–∫–∞–º–∏ + –∫–æ—Ä–æ—Ç–∫–∏–º–∏ WorkManager –∑–∞–¥–∞—á–∞–º–∏ + –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π - —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞ Android 15+.